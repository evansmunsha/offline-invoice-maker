<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />

        <!-- Makes app scale correctly on mobile -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>Offline Invoice Maker</title>

        <!-- PWA Manifest -->
        <link rel="manifest" href="manifest.json" />
        <!-- Theme color for browser UI -->
        <meta name="theme-color" content="#ffffff" />

        <!-- Main stylesheet -->
        <link rel="stylesheet" href="css/style.css" />
    </head>
    <body>
        <!-- APP HEADER -->
        <header class="app-header" role="banner">
            <h1>Invoice Maker</h1>
            <p>Create simple invoices. Works offline.</p>
        </header>

        <main id="main" role="main">
            <!-- ================= INVOICE INFO ================= -->
            <section
                class="card"
                role="region"
                aria-labelledby="invoice-details-heading"
            >
                <h2 id="invoice-details-heading">Invoice Details</h2>
                <p class="hint">This information appears on your invoice</p>

                <label for="businessName">
                    Business Name
                    <span class="required" aria-label="required">*</span>
                    <input
                        id="businessName"
                        placeholder="e.g. Munsha Services"
                        required
                        class="form-field"
                        aria-required="true"
                        aria-describedby="businessNameError"
                        aria-label="Business name, required field"
                    />
                    <span
                        class="error-message"
                        id="businessNameError"
                        role="alert"
                        aria-live="polite"
                    ></span>
                </label>

                <label for="clientName">
                    Client Name (optional)
                    <input
                        id="clientName"
                        placeholder="e.g. John Banda"
                        class="form-field"
                        aria-label="Client name, optional field"
                    />
                </label>

                <div class="date-time-group">
                    <label for="invoiceDate">
                        Invoice Date
                        <span class="required" aria-label="required">*</span>
                        <input
                            id="invoiceDate"
                            type="date"
                            required
                            class="form-field"
                            aria-required="true"
                            aria-describedby="invoiceDateError"
                            aria-label="Invoice date, required field"
                        />
                        <span
                            class="error-message"
                            id="invoiceDateError"
                            role="alert"
                            aria-live="polite"
                        ></span>
                    </label>

                    <label for="invoiceTime">
                        Invoice Time
                        <input
                            id="invoiceTime"
                            type="time"
                            class="form-field"
                            aria-label="Invoice time, optional field"
                        />
                    </label>
                </div>

                <label for="invoiceNumber">
                    Invoice Number
                    <input
                        id="invoiceNumber"
                        placeholder="Auto-generated"
                        readonly
                        class="form-field readonly"
                        aria-label="Invoice number, automatically generated"
                        aria-readonly="true"
                    />
                </label>
            </section>

            <!-- ================= ITEMS ================= -->
            <section
                class="card"
                role="region"
                aria-labelledby="invoice-items-heading"
            >
                <h2 id="invoice-items-heading">Invoice Items</h2>
                <p class="hint">
                    Add products or services you are charging for
                </p>

                <!-- Example/helper text -->
                <div class="items-example">
                    <div class="example-header">
                        <strong>üí° Example:</strong> "Website Design" √ó 1 at
                        $500.00 = $500.00
                    </div>
                    <div class="example-text">
                        Enter item name, quantity, and price per unit. Total is
                        calculated automatically.
                    </div>
                </div>

                <!-- Column headers for items -->
                <div class="items-header">
                    <div class="header-item">Item Description</div>
                    <div class="header-qty">Qty</div>
                    <div class="header-price">Unit Price</div>
                    <div class="header-action">Action</div>
                </div>

                <!-- Items will be added here dynamically -->
                <div id="items" role="list" aria-label="Invoice items"></div>

                <button id="addItem" aria-label="Add new item to invoice">
                    + Add Item
                </button>

                <label for="currency">
                    Currency
                    <select
                        id="currency"
                        aria-label="Select currency for invoice"
                    >
                        <option value="ZMW">ZMW ‚Äì Zambian Kwacha</option>
                        <option value="$">USD ‚Äì Dollar</option>
                        <option value="‚Ç¨">EUR ‚Äì Euro</option>
                        <option value="¬£">GBP ‚Äì Pound</option>
                    </select>
                </label>

                <p
                    class="total"
                    role="status"
                    aria-live="polite"
                    aria-label="Invoice total"
                >
                    Total: <span id="total">0</span>
                </p>
            </section>

            <!-- ================= PDF SETTINGS ================= -->
            <section
                class="card"
                role="region"
                aria-labelledby="pdf-settings-heading"
            >
                <h2 id="pdf-settings-heading">PDF Template</h2>
                <p class="hint">Choose how your PDF invoice will look</p>

                <label for="template">
                    Template Style
                    <select
                        id="template"
                        aria-label="Select PDF template style"
                    >
                        <option value="simple">Simple</option>
                        <option value="boxed">Boxed</option>
                    </select>
                </label>
            </section>

            <!-- ================= ACTIONS ================= -->
            <section
                class="card"
                role="region"
                aria-labelledby="actions-heading"
            >
                <h2 id="actions-heading" class="sr-only">Invoice Actions</h2>
                <button
                    class="primary"
                    id="saveInvoice"
                    aria-label="Save invoice to database"
                >
                    üíæ Save Invoice
                </button>

                <button
                    class="secondary"
                    id="generatePDF"
                    aria-label="Generate and download PDF"
                >
                    üìÑ Generate PDF
                </button>

                <button
                    class="secondary"
                    id="shareInvoice"
                    aria-label="Share invoice"
                >
                    üîó Share Invoice
                </button>

                <p class="hint">
                    Works offline. Internet is only needed for sharing.
                </p>

                <!-- Usage Stats for Free Users -->
                <div id="usageStats" class="usage-stats hidden">
                    <div class="usage-header">
                        <span class="usage-title">üìä Your Usage (Free Plan)</span>
                        <button id="viewUsageDetails" class="usage-details-btn">View Details</button>
                    </div>
                    <div class="usage-bars">
                        <div class="usage-bar">
                            <div class="usage-label">
                                <span>Invoices this month</span>
                                <span id="invoiceUsage">0/10</span>
                            </div>
                            <div class="progress-bar">
                                <div id="invoiceProgress" class="progress-fill"></div>
                            </div>
                        </div>
                        <div class="usage-bar">
                            <div class="usage-label">
                                <span>PDFs today</span>
                                <span id="pdfUsage">0/5</span>
                            </div>
                            <div class="progress-bar">
                                <div id="pdfProgress" class="progress-fill"></div>
                            </div>
                        </div>
                    </div>
                    <div class="usage-upgrade" style="display: none;">
                        <p>Need more? <a href="#" id="upgradeFromStats">Upgrade to Premium</a> for unlimited usage!</p>
                    </div>
                </div>

                <!-- Ad Container for Free Users -->
                <div id="adContainer" class="ad-container hidden">
                    <div class="ad-header">
                        <span class="ad-label">Advertisement</span>
                    </div>
                    <div id="adSpace" class="ad-space">
                        <!-- Google AdSense or other ads will be inserted here -->
                        <div class="demo-ad">
                            <div class="ad-logo">üíº</div>
                            <p class="ad-title"><strong>Grow Your Business</strong></p>
                            <p class="ad-subtitle">Get paid faster with professional invoices</p>
                            <div class="ad-features">
                                <span class="ad-feature">‚úì WhatsApp sharing</span>
                                <span class="ad-feature">‚úì Offline ready</span>
                                <span class="ad-feature">‚úì Multi-currency</span>
                            </div>
                            <a href="#" class="ad-link">Learn More ‚Üí</a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Premium Upgrade Modal - DISABLED FOR NOW -->
            <div id="premiumModal" class="modal hidden" role="dialog" aria-labelledby="premiumModalTitle" aria-modal="true" style="display: none !important;">
                <div class="modal-content" style="display: none !important;">
                    <div class="modal-header">
                        <h3 id="premiumModalTitle">Upgrade to Premium</h3>
                        <button class="modal-close" id="closePremiumModal" aria-label="Close premium dialog">
                            &times;
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="premium-features">
                            <h4 id="premiumModalHeading">üöÄ Unlock Premium Features</h4>
                            <div class="feature-list">
                                <div class="feature-item">
                                    <span class="feature-icon">‚úÖ</span>
                                    <span>Remove all advertisements</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon">‚úÖ</span>
                                    <span>Remove watermark from PDFs</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon">‚úÖ</span>
                                    <span>Unlimited invoice generation</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon">‚úÖ</span>
                                    <span>Priority customer support</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon">‚úÖ</span>
                                    <span>Lifetime updates included</span>
                                </div>
                            </div>
                            <div class="pricing">
                                <div class="price-tag">
                                    <span class="price-amount">$4.99</span>
                                    <span class="price-period" id="paymentMethod">One-time payment</span>
                                </div>
                            </div>

                            <!-- Platform-specific messages -->
                            <div id="platformMessage" class="platform-message hidden">
                                <div id="webMessage" class="platform-msg">
                                    <p>üì± <strong>Get the Android App</strong></p>
                                    <p>Premium features are available in our Android app on Google Play Store.</p>
                                    <a href="#" id="playStoreLink" class="play-store-link">
                                        üì≤ Download from Play Store
                                    </a>
                                </div>
                                <div id="androidMessage" class="platform-msg hidden">
                                    <p>üí≥ <strong>Secure Google Play Payment</strong></p>
                                    <p>Payment handled securely by Google Play. No card details stored in app.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="purchasePremium" class="primary premium-btn">
                            üöÄ Upgrade Now - $4.99
                        </button>
                        <button id="cancelPremium" class="secondary">
                            Maybe Later
                        </button>
                    </div>
                </div>
            </div>
            </section>

            <!-- ================= HISTORY ================= -->
            <section
                id="history"
                role="region"
                aria-labelledby="history-heading"
            >
                <h2 id="history-heading">Invoice History</h2>
                <div class="history-controls" role="search">
                    <div class="search-box">
                        <input
                            type="text"
                            id="searchInvoices"
                            placeholder="üîç Search invoices by client name..."
                            class="search-input"
                            aria-label="Search invoices by client name, business name, or invoice number"
                        />
                    </div>
                    <div class="filter-controls">
                        <div class="select-all-group">
                            <label class="select-all-label">
                                <input
                                    type="checkbox"
                                    id="selectAllInvoices"
                                    aria-label="Select all visible invoices"
                                />
                                <span>Select All</span>
                            </label>
                        </div>
                        <label for="sortBy" class="sr-only"
                            >Sort invoices by</label
                        >
                        <select
                            id="sortBy"
                            class="filter-select"
                            aria-label="Sort invoices by"
                        >
                            <option value="date-desc">Newest First</option>
                            <option value="date-asc">Oldest First</option>
                            <option value="client-asc">Client A-Z</option>
                            <option value="total-desc">Highest Amount</option>
                        </select>
                    </div>
                </div>

                <!-- Bulk actions for selected invoices -->
                <div class="bulk-actions hidden" id="bulkActions">
                    <div class="bulk-info">
                        <span id="selectedCount">0</span> invoices selected
                        <button
                            id="expandBulkActions"
                            class="expand-bulk-btn"
                            aria-label="Show more bulk actions"
                        >
                            ‚ãØ
                        </button>
                    </div>
                    <div class="bulk-buttons" id="bulkButtonsContainer">
                        <div class="bulk-primary-actions">
                            <button
                                id="bulkWhatsApp"
                                class="whatsapp-quick"
                                aria-label="Share selected invoices via WhatsApp"
                            >
                                üí¨ WhatsApp
                            </button>
                            <button
                                id="bulkShare"
                                class="secondary"
                                aria-label="Share selected invoices"
                            >
                                üîó Share
                            </button>
                        </div>
                        <div
                            class="bulk-secondary-actions hidden"
                            id="bulkSecondaryActions"
                        >
                            <button
                                id="bulkExportPDF"
                                class="secondary"
                                aria-label="Export selected invoices as PDF"
                            >
                                üìÑ Export PDFs
                            </button>
                            <button
                                id="bulkDelete"
                                class="danger"
                                aria-label="Delete selected invoices"
                            >
                                üóëÔ∏è Delete
                            </button>
                            <button
                                id="clearSelection"
                                class="secondary"
                                aria-label="Clear selection"
                            >
                                ‚úï Clear
                            </button>
                        </div>
                    </div>
                </div>
                <ul
                    id="invoiceList"
                    role="list"
                    aria-label="List of saved invoices"
                ></ul>
            </section>

            <!-- Enhanced modal for viewing/editing invoices -->
            <div
                id="invoiceModal"
                class="modal hidden"
                role="dialog"
                aria-labelledby="modalTitle"
                aria-modal="true"
            >
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modalTitle">Edit Invoice</h3>
                        <button
                            class="modal-close"
                            id="closeModal"
                            aria-label="Close dialog"
                        >
                            &times;
                        </button>
                    </div>

                    <div class="modal-body">
                        <div class="modal-section">
                            <label for="editInvoiceNumber">
                                Invoice Number
                                <input
                                    id="editInvoiceNumber"
                                    readonly
                                    class="readonly"
                                    aria-label="Invoice number, read-only"
                                />
                            </label>

                            <label for="editBusinessName">
                                Business Name
                                <input
                                    id="editBusinessName"
                                    placeholder="Business Name"
                                    aria-label="Business name"
                                />
                            </label>

                            <label for="editClientName">
                                Client Name
                                <input
                                    id="editClientName"
                                    placeholder="Client Name"
                                    aria-label="Client name"
                                />
                            </label>

                            <div class="date-time-group">
                                <label for="editDate">
                                    Date
                                    <input
                                        id="editDate"
                                        type="date"
                                        aria-label="Invoice date"
                                    />
                                </label>

                                <label for="editTime">
                                    Time
                                    <input
                                        id="editTime"
                                        type="time"
                                        aria-label="Invoice time"
                                    />
                                </label>
                            </div>
                        </div>

                        <div class="modal-section">
                            <h4 id="edit-items-heading">Items</h4>

                            <!-- Column headers for edit items -->
                            <div class="edit-items-header">
                                <div class="header-item">Item Description</div>
                                <div class="header-qty">Qty</div>
                                <div class="header-price">Unit Price</div>
                                <div class="header-action">Action</div>
                            </div>

                            <div
                                id="editItems"
                                role="list"
                                aria-labelledby="edit-items-heading"
                            ></div>
                            <button
                                type="button"
                                id="addEditItem"
                                class="secondary"
                                aria-label="Add new item to edit invoice"
                            >
                                + Add Item
                            </button>
                        </div>

                        <div class="modal-section">
                            <div
                                class="total-display"
                                role="status"
                                aria-live="polite"
                                aria-label="Edit invoice total"
                            >
                                <strong
                                    >Total:
                                    <span id="editTotal">$0.00</span></strong
                                >
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button
                            id="saveEdit"
                            class="primary"
                            aria-label="Save changes to invoice"
                        >
                            üíæ Save Changes
                        </button>
                        <button
                            id="duplicateInvoice"
                            class="secondary"
                            aria-label="Create a duplicate of this invoice"
                        >
                            üìã Duplicate
                        </button>
                        <button
                            id="cancelEdit"
                            class="secondary"
                            aria-label="Cancel editing and close dialog"
                        >
                            Cancel
                        </button>
                    </div>
                </div>
            </div>

            <!-- Share modal -->
            <div
                id="shareModal"
                class="modal hidden"
                role="dialog"
                aria-labelledby="shareModalTitle"
                aria-modal="true"
            >
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="shareModalTitle">Share Invoice</h3>
                        <button
                            class="modal-close"
                            id="closeShareModal"
                            aria-label="Close share dialog"
                        >
                            &times;
                        </button>
                    </div>

                    <div class="modal-body">
                        <div class="share-options">
                            <button
                                class="share-option"
                                id="shareNative"
                                aria-label="Share using device's native share menu"
                            >
                                <div class="share-option-icon">üì±</div>
                                <div class="share-option-title">
                                    Native Share
                                </div>
                                <div class="share-option-desc">
                                    Use your device's share menu
                                </div>
                            </button>

                            <button
                                class="share-option"
                                id="sharePDF"
                                aria-label="Generate and share PDF"
                            >
                                <div class="share-option-icon">üìÑ</div>
                                <div class="share-option-title">Share PDF</div>
                                <div class="share-option-desc">
                                    Generate PDF and share
                                </div>
                            </button>

                            <button
                                class="share-option"
                                id="shareEmail"
                                aria-label="Share via email"
                            >
                                <div class="share-option-icon">‚úâÔ∏è</div>
                                <div class="share-option-title">Email</div>
                                <div class="share-option-desc">
                                    Send via email client
                                </div>
                            </button>

                            <button
                                class="share-option"
                                id="shareWhatsApp"
                                aria-label="Share via WhatsApp"
                            >
                                <div class="share-option-icon">üí¨</div>
                                <div class="share-option-title">WhatsApp</div>
                                <div class="share-option-desc">
                                    Send via WhatsApp
                                </div>
                            </button>

                            <button
                                class="share-option"
                                id="shareData"
                                aria-label="Copy invoice data"
                            >
                                <div class="share-option-icon">üìã</div>
                                <div class="share-option-title">Copy Data</div>
                                <div class="share-option-desc">
                                    Copy invoice details as text
                                </div>
                            </button>
                        </div>

                        <div class="share-link-section">
                            <h4>WhatsApp Direct Contact</h4>
                            <p class="hint">
                                Enter phone number to send directly to WhatsApp
                                contact
                            </p>
                            <div class="share-link-group">
                                <input
                                    type="tel"
                                    id="whatsappNumber"
                                    class="share-link-input"
                                    placeholder="+1234567890"
                                    aria-label="WhatsApp phone number"
                                />
                                <button
                                    id="sendWhatsAppDirect"
                                    class="copy-button"
                                    aria-label="Send directly to WhatsApp contact"
                                >
                                    üí¨ Send
                                </button>
                            </div>
                        </div>

                        <div class="share-link-section">
                            <h4>Quick Share Link</h4>
                            <p class="hint">
                                Copy this link to share invoice details
                            </p>
                            <div class="share-link-group">
                                <input
                                    type="text"
                                    id="shareLink"
                                    class="share-link-input"
                                    readonly
                                    aria-label="Shareable link for invoice"
                                />
                                <button
                                    id="copyLink"
                                    class="copy-button"
                                    aria-label="Copy share link to clipboard"
                                >
                                    üìã Copy
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button
                            id="closeShareModalBtn"
                            class="secondary"
                            aria-label="Close share dialog"
                        >
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast notifications container -->
        <div
            id="toast-container"
            aria-live="polite"
            aria-label="Notifications"
        ></div>

        <!-- Loading overlay -->
        <div
            id="loading-overlay"
            class="loading-overlay hidden"
            role="dialog"
            aria-modal="true"
            aria-labelledby="loading-message"
        >
            <div class="loading-spinner">
                <div class="spinner" aria-hidden="true"></div>
                <p id="loading-message">Generating PDF...</p>
            </div>
        </div>

        <!-- App Footer -->
        <footer class="app-footer">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="privacy-policy.html" target="_blank" class="footer-link">Privacy Policy</a>
                    <span class="footer-separator">‚Ä¢</span>
                    <a href="terms-of-service.html" target="_blank" class="footer-link">Terms of Service</a>
                    <span class="footer-separator">‚Ä¢</span>
                    <a href="#" id="aboutApp" class="footer-link">About</a>
                    <span class="footer-separator">‚Ä¢</span>
                    <a href="#" id="supportLink" class="footer-link">Support</a>
                </div>
                <div class="footer-text">
                    <p>&copy; 2024 Invoice Maker - Professional invoicing made simple</p>
                    <p class="footer-tagline">Your data stays on your device ‚Ä¢ Privacy-first ‚Ä¢ Offline-ready</p>
                </div>
            </div>
        </footer>

        <!-- External libraries -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

        <!-- App scripts -->
        <script src="./js/storage.js"></script>
        <script src="./js/pdf.js"></script>
        <script src="./js/app.js"></script>
        <!-- Service Worker Registration -->
        <script>
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker.register('./sw.js')
                        .then(reg => {
                            console.log("‚úÖ Service Worker registered:", reg);
                        })
                        .catch(err => {
                            console.error("‚ùå Service Worker registration failed:", err);
                        });
                });
            }
        </script>


    </body>
</html>
